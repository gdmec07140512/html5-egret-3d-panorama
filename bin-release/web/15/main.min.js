var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)},__decorate=this&&this.__decorate||function(e,t,n,r){var o,i=arguments.length,a=3>i?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(a=(3>i?o(a):i>3?o(t,n,a):o(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},__awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r["throw"](e))}catch(t){i(t)}}function c(e){e.done?o(e.value):new n(function(t){t(e.value)}).then(a,s)}c((r=r.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(a=s.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){s.label=n[1];break}if(6===n[0]&&s.label<a[1]){s.label=a[1],a=n;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(n);break}a[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(r){n=[6,r],i=0}finally{o=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var o,i,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return{next:n(0),"throw":n(1),"return":n(2)}},GameScene=function(){function e(e){this.lights=new egret3d.LightGroup,egret3d.Input.addEventListener(egret3d.OrientationEvent3D.ORIENTATION_CHANGE,this.OnOrientationChange,this),egret3d.Input.addEventListener(egret3d.OrientationEvent3D.DEVICE_MOTION,this.OnOrientationMotion,this),egret3d.Input.addEventListener(egret3d.OrientationEvent3D.DEVICE_ORIENTATION,this.OnDeviceOrientation,this);var t=new egret3d.View3D(0,0,e.width,e.height);t.camera3D.lookAt(new egret3d.Vector3D(0,1e3,-1e3),new egret3d.Vector3D(0,0,0)),t.backColor=4279769112,e.addView3D(t),this.view=t,this.cameraCtl=new egret3d.LookAtController(t.camera3D,new egret3d.Object3D),this.cameraCtl.lookAtObject.y=100,this.cameraCtl.distance=120,this.cameraCtl.rotationX=0,this.cameraCtl.rotationY=0,e.addEventListener(egret3d.Event3D.ENTER_FRAME,this.update,this),this.tuoluo=new egret3d.OrientationController}return e.prototype.OnOrientationChange=function(e){},e.prototype.OnOrientationMotion=function(e){},e.prototype.OnDeviceOrientation=function(e){this.cameraCtl.rotationY=e.gamma,this.tuoluo.stop()},e.prototype.createGameScene=function(){var e=RES.getRes("3d/background.jpg");console.log(e),this.view.backImage=e;var t=RES.getRes("3d/127.jpg");t.repeat=!0;var n=(new egret3d.TextureMaterial,new egret3d.SphereGeometry(200,45,45));this.model=new egret3d.Mesh(n),this.model.material.lightGroup=this.lights,this.model.material.diffuseTexture=t,this.model.y=100,this.view.addChild3D(this.model)},e.prototype.onKeyDown=function(e){switch(e.keyCode){case egret3d.KeyCode.Key_1:this.mesh.animation.play("attack")}},e.prototype.onAnimationComplete=function(e){console.log("onAnimationComplete"),this.mesh.animation.play("idle")},e.prototype.onAnimationCycle=function(e){console.log("播放完成一个循环")},e.prototype.update=function(e){this.cameraCtl.update()},e}();__reflect(GameScene.prototype,"GameScene");var Main=function(e){function t(){var t=e.call(this)||this;return utils.map(),t.once(egret.Event.ADDED_TO_STAGE,function(){return __awaiter(t,void 0,void 0,function(){var e,t;return __generator(this,function(n){switch(n.label){case 0:return e=new egret3d.Egret3DCanvas(this.stage),egret.setRendererContext(e),t=new GameScene(e),[4,this.loadAssets()];case 1:return n.sent(),t.createGameScene(),[2]}})})},t),t}return __extends(t,e),t.prototype.loadAssets=function(){return __awaiter(this,void 0,void 0,function(){function e(e){return __awaiter(this,void 0,void 0,function(){var t,n,r;return __generator(this,function(o){switch(o.label){case 0:t=0,n=e,o.label=1;case 1:return t<n.length?(r=n[t],[4,RES.getResAsync(r)]):[3,4];case 2:o.sent(),o.label=3;case 3:return t++,[3,1];case 4:return[2]}})})}var t,n,r;return __generator(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig()];case 1:return o.sent(),n=["3d/background.jpg","3d/2.jpg","3d/0_Model/Esm/Zhouyu.esm","3d/0_Model/Eam/attack.eam","3d/0_Model/Eam/idle.eam","3d/0_Model/Texture/hero_01.png","3d/127.jpg"],[4,e(n)];case 2:return o.sent(),this.stage.removeChild(t),[3,4];case 3:return r=o.sent(),alert(r.message),[3,4];case 4:return[2]}})})},t}(egret.DisplayObject);Main=__decorate([RES.mapConfig("config.json",function(){return"resource"},function(e){var t=e.substr(e.lastIndexOf(".")+1),n="";if(e.indexOf("3d")>=0)n="unit";else{var r={jpg:"image",png:"image",webp:"image",json:"json",fnt:"font",pvr:"pvr",mp3:"sound"};n=r[t],"json"==n&&(e.indexOf("sheet")>=0?n="sheet":e.indexOf("movieclip")>=0&&(n="movieclip"))}return n})],Main),__reflect(Main.prototype,"Main");var utils;!function(e){function t(e,t){var n=this;return new Promise(function(r,o){e.addEventListener(egret3d.LoaderEvent3D.LOADER_COMPLETE,function(){r(e.data)},n),e.load("resource/"+t)})}function n(){var e=this;RES.processor.map("unit",{onLoadStart:function(n,r){return __awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(n){return e=new egret3d.UnitLoader,[2,t(e,r.url)]})})},onRemoveStart:function(t,n){return __awaiter(e,void 0,void 0,function(){return __generator(this,function(e){return[2,Promise.resolve()]})})}})}e.map=n}(utils||(utils={}));var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.textField=new egret.TextField,t.addChild(t.textField),t.textField.x=t.textField.y=200,t.textField.text="loading...",t}return __extends(t,e),t.prototype.onProgress=function(e,t){this.textField.text=e+" / "+t,console.log(e,t)},t}(egret.DisplayObjectContainer);__reflect(LoadingUI.prototype,"LoadingUI");